<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Elegance Enclave - Flats for Rent</title>
  <style>
   :root {
      --bg: #f3f6fa;
      --primary: #2563eb;
      --primary-dark: #1e3a8a;
      --accent: #38bdf8;
      --accent-2: #fbbf24;
      --danger: #ef4444;
      --card-radius: 16px;
      --header-radius: 22px;
      --shadow: 0 6px 18px rgba(37,99,235,0.08);
      --header-shadow: 0 4px 14px rgba(37,99,235,0.18);
      --font: 'Poppins', Arial, sans-serif;
    }
  body { font-family: Arial, sans-serif; background: #fff; margin: 0; padding: 0; }
   header {
      background: linear-gradient(90deg, var(--primary-dark) 60%, var(--primary) 100%);
      color: #fff;
      padding: 22px 24px;
      font-size: 1.7rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom-left-radius: var(--header-radius);
      border-bottom-right-radius: var(--header-radius);
      box-shadow: var(--header-shadow);
      margin-bottom: 20px;
    }

header h1 {
  margin: 0 auto;
  font-size: 30px;
  lex-grow: 1;
  text-align: center;
}

/*header a.home-link {*/
/*  background: white;*/
/*  color: purple;*/
/*  padding: 6px 12px;*/
/*  border-radius: 6px;*/
/*  text-decoration: none;*/
/*  font-weight: bold;*/
/*}*/

header h1.header-logo {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      object-fit: cover;
      box-shadow: 0 2px 12px rgba(0,0,0,0.13);
      border: 2px solid #fff;
      background: #fff;
      flex-shrink: 0;
}
    .container { width: 90%; max-width: 1100px; margin: 20px auto; }
    .login-box, .flat-form, .user-form, .pending-list {
      background: white; padding: 20px; border-radius: 10px;
      margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    label { display: block; margin-top: 8px; font-size: 13px; color: #333; }
    input, select {
      width: 100%; padding: 8px 12px; font-size: 16px; margin-top: 5px;
      border-radius: 6px; border: 1px solid #ccc; box-sizing: border-box;
    }
    button {
      margin-top: 12px; padding: 10px 18px; font-size: 16px; border: none;
      background: purple; color: white; border-radius: 6px; cursor: pointer;
      transition: background 0.2s ease;
    }
    button:hover { background: #5a005a; }
    .controls { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:18px; }
    .controls > * { flex:1; min-width:120px; }
    .flat-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
    .flat-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.15); border-left: 6px solid purple; }
    .flat-card h3 { margin: 0; color: purple; }
    .flat-card p { margin: 5px 0; font-size: 14px; }
    .delete-btn { background: red; color: white; border: none; padding:8px 12px; margin-right:8px; border-radius:6px; cursor:pointer; }
    .approve-btn { background: green; color: white; border: none; padding:8px 12px; margin-right:8px; border-radius:6px; cursor:pointer; }
    .reject-btn { background: orange; color: white; border: none; padding:8px 12px; border-radius:6px; cursor:pointer; }
    .whatsapp { display: inline-block; margin-top: 10px; background: #25d366; color: white; padding: 6px 10px; border-radius: 5px; text-decoration: none; font-size: 13px; }
    #adminPassword { width: 200px; display: inline-block; }
    @media (max-width:600px) {
      .controls { flex-direction: column; }
    }
  </style>
</head>
<body>
 <header>
      <a href="https://eleganceenclave.tiiny.site" target="_blank">
  <img src="https://i.ibb.co/ZRNQxN5q/file-00000000777461fa82518c850f7680e9.png"
       alt="Elegance Enclave Logo"
       style="width:56px; height:56px; border-radius:50%; object-fit:cover; background:white; padding:2px; box-shadow:0 2px 8px rgba(0,0,0,0.10);"/>
</a>
    <h1>Elegance Enclave - Flats for Rent</h1>
</header>

  <div class="container">
    <div class="controls">
      <button id="toggleLoginBtn" onclick="toggleLogin()">Admin Login</button>
      <button id="postFlatBtn" onclick="toggleUserForm()">Post Your Flat</button>
    </div>

    <!-- Admin Login -->
    <div class="login-box" id="loginBox" style="display:none;">
      <h2>Admin Login</h2>
      <label>Password: <input type="password" id="adminPassword" /></label>
      <button onclick="login()">Login</button>
    </div>

    <!-- Logout -->
    <div id="logoutBox" style="display:none; margin-bottom:20px;">
      <button onclick="logout()">Logout</button>
    </div>

    <!-- Admin Form -->
    <div class="flat-form" id="adminForm" style="display:none;">
      <h2>Add / Edit Flat (Admin)</h2>
      <label>Flat Number:
        <select id="flatNumber" onchange="autoFillFloor('flatNumber','floor')">
          <option value="">-- Select Flat Number --</option>
          <option value="001">001</option><option value="002">002</option><option value="003">003</option>
          <option value="004">004</option><option value="005">005</option><option value="006">006</option><option value="007">007</option>
          <option value="101">101</option><option value="102">102</option><option value="103">103</option><option value="104">104</option><option value="105">105</option><option value="106">106</option><option value="107">107</option>
          <option value="201">201</option><option value="202">202</option><option value="203">203</option><option value="204">204</option><option value="205">205</option><option value="206">206</option><option value="207">207</option>
          <option value="301">301</option><option value="302">302</option><option value="303">303</option><option value="304">304</option><option value="305">305</option><option value="306">306</option><option value="307">307</option>
          <option value="401">401</option><option value="402">402</option><option value="403">403</option><option value="404">404</option><option value="405">405</option><option value="406">406</option><option value="407">407</option>
          <option value="501">501</option><option value="502">502</option><option value="503">503</option>
        </select>
      </label>
      <label>Floor: <input type="text" id="floor" readonly /></label>
      <label>Sqft: <input type="number" id="sqft" /></label>
      <label>Rent: <input type="number" id="rent" required /></label>
      <label>Advance Deposit: <input type="number" id="deposit" required /></label>
      <label>Maintenance: <input type="number" id="maintenance" required /></label>
      <label>Mobile Number: <input type="tel" id="mobile" required /></label>
      <label>Show my number to tenant?
        <select id="showNumber"><option value="Yes">Yes</option><option value="No">No</option></select>
      </label>
      <button onclick="addFlat('admin')">Add Flat</button>
    </div>

    <!-- User Form -->
    <div class="user-form" id="userForm" style="display:none;">
      <h2>Post Your Flat for Rent</h2>
      <label>Flat Number:
        <select id="userFlatNumber" onchange="autoFillFloor('userFlatNumber','userFloor')">
          <option value="">-- Select Flat Number --</option>
          <option value="001">001</option><option value="002">002</option><option value="003">003</option>
          <option value="004">004</option><option value="005">005</option><option value="006">006</option><option value="007">007</option>
          <option value="101">101</option><option value="102">102</option><option value="103">103</option><option value="104">104</option><option value="105">105</option><option value="106">106</option><option value="107">107</option>
          <option value="201">201</option><option value="202">202</option><option value="203">203</option><option value="204">204</option><option value="205">205</option><option value="206">206</option><option value="207">207</option>
          <option value="301">301</option><option value="302">302</option><option value="303">303</option><option value="304">304</option><option value="305">305</option><option value="306">306</option><option value="307">307</option>
          <option value="401">401</option><option value="402">402</option><option value="403">403</option><option value="404">404</option><option value="405">405</option><option value="406">406</option><option value="407">407</option>
          <option value="501">501</option><option value="502">502</option><option value="503">503</option>
        </select>
      </label>
      <label>Floor: <input type="text" id="userFloor" readonly /></label>
      <label>Sqft: <input type="number" id="userSqft" /></label>
      <label>Rent: <input type="number" id="userRent" required /></label>
      <label>Advance Deposit: <input type="number" id="userDeposit" required /></label>
      <label>Maintenance: <input type="number" id="userMaintenance" required /></label>
      <label>Mobile Number: <input type="tel" id="userMobile" required /></label>
      <label>Show my number to tenant?
        <select id="userShowNumber"><option value="Yes">Yes</option><option value="No">No</option></select>
      </label>
      <button onclick="addFlat('user')">Submit for Approval</button>
    </div>

    <!-- Pending Flats -->
    <div class="pending-list" id="pendingList" style="display:none;">
      <h2>Pending Approvals (Admin Only)</h2>
      <div id="pendingFlats"></div>
    </div>

    <h2 id="availableFlatsHeader">Available Flats</h2>
    <div class="flat-list" id="flatList"></div>
  </div>

  <!-- Firebase + Script -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc, updateDoc, query, where } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Firebase config (already in your project)
    const firebaseConfig = {
      apiKey: "AIzaSyDykGxIq2GUDxFkv28NLmdRmiQzlEjvFuw",
      authDomain: "rento-56bca.firebaseapp.com",
      projectId: "rento-56bca",
      storageBucket: "rento-56bca.appspot.com",
      messagingSenderId: "641174222477",
      appId: "1:641174222477:web:583370943c737c015d14c4",
      measurementId: "G-G2S1HW7ZNT"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let flats = [];
    let pendingFlats = [];
    let isAdmin = false;
    const defaultAppContact = "8260147054"; // used when owner chooses not to show number

    // SHA-256 hash for "admin123"
    const adminPasswordHash = "240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9";

    async function sha256(message) {
      const msgBuffer = new TextEncoder().encode(message);
      const hashBuffer = await crypto.subtle.digest("SHA-256", msgBuffer);
      return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, "0")).join("");
    }

    function toggleLogin() {
      const box = document.getElementById("loginBox");
      box.style.display = (box.style.display === "none") ? "block" : "none";
    }

    function toggleUserForm() {
      const box = document.getElementById("userForm");
      box.style.display = (box.style.display === "none") ? "block" : "none";
    }

    async function login() {
      const pass = document.getElementById("adminPassword").value;
      const hash = await sha256(pass);
      if (hash === adminPasswordHash) {
        isAdmin = true;
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("adminForm").style.display = "block";
        document.getElementById("toggleLoginBtn").style.display = "none";
        document.getElementById("postFlatBtn").style.display = "none";
        document.getElementById("userForm").style.display = "none";
        document.getElementById("logoutBox").style.display = "block";
        document.getElementById("pendingList").style.display = "block";
        await loadFlats();
      } else {
        alert("Incorrect Password!");
      }
    }

    function logout() {
      isAdmin = false;
      document.getElementById("adminForm").style.display = "none";
      document.getElementById("logoutBox").style.display = "none";
      document.getElementById("toggleLoginBtn").style.display = "inline-block";
      document.getElementById("postFlatBtn").style.display = "inline-block";
      document.getElementById("pendingList").style.display = "none";
      loadFlats();
    }

    function isValidMobile(number) {
      const regex = /^[6-9]\d{9}$/;
      return regex.test(number);
    }

    function autoFillFloor(selectId, floorId) {
      const flat = document.getElementById(selectId).value || "";
      let floorText = "";

      if (/^00[1-7]$/.test(flat)) floorText = "Ground Floor";
      else if (/^10[1-7]$/.test(flat)) floorText = "1st Floor";
      else if (/^20[1-7]$/.test(flat)) floorText = "2nd Floor";
      else if (/^30[1-7]$/.test(flat)) floorText = "3rd Floor";
      else if (/^40[1-7]$/.test(flat)) floorText = "4th Floor";
      else if (/^50[1-3]$/.test(flat)) floorText = "5th Floor";
      else floorText = "";

      document.getElementById(floorId).value = floorText;
    }

    async function flatExists(flatNumber) {
      if (!flatNumber) return false;
      const q = query(collection(db, "flats"), where("flatNumber", "==", flatNumber));
      const snapshot = await getDocs(q);
      return !snapshot.empty;
    }

    function clearForm(formId) {
      document.querySelectorAll(`#${formId} input, #${formId} select`).forEach(el => {
        // keep readonly fields as-is
       // if (!el.readOnly) 
          el.value = "";
      });
    }

    async function loadFlats() {
      flats = [];
      pendingFlats = [];
      const snapshot = await getDocs(collection(db, "flats"));
      snapshot.forEach(docSnap => {
        const flat = { id: docSnap.id, ...docSnap.data() };
        if (flat.status === "approved") flats.push(flat);
        else if (flat.status === "pending") pendingFlats.push(flat);
      });
      renderFlats();
      if (isAdmin) renderPending();
    }

    async function addFlat(type) {
      const flatNumber = (type === "admin" ? document.getElementById("flatNumber").value : document.getElementById("userFlatNumber").value) || "";
      const floor = (type === "admin" ? document.getElementById("floor").value : document.getElementById("userFloor").value) || "";
      const sqft = (type === "admin" ? document.getElementById("sqft").value : document.getElementById("userSqft").value) || "";
      const rent = (type === "admin" ? document.getElementById("rent").value : document.getElementById("userRent").value) || "";
      const deposit = (type === "admin" ? document.getElementById("deposit").value : document.getElementById("userDeposit").value) || "";
      const maintenance = (type === "admin" ? document.getElementById("maintenance").value : document.getElementById("userMaintenance").value) || "";
      const mobile = (type === "admin" ? document.getElementById("mobile").value : document.getElementById("userMobile").value) || "";
      const showNumber = (type === "admin" ? document.getElementById("showNumber").value : document.getElementById("userShowNumber").value) || "Yes";
      const status = type === "admin" ? "approved" : "pending";

      // required field checks
      if (!flatNumber || !rent || !deposit || !maintenance || !mobile) {
        alert("Please fill all required fields!");
        return;
      }
      if (!isValidMobile(mobile)) {
        alert("Please enter a valid 10-digit Indian mobile number.");
        return;
      }
      // check duplicates (approved or pending)
      if (await flatExists(flatNumber)) {
        alert("This flat is already posted!");
        return;
      }

      const flatObj = { flatNumber, floor, sqft, rent, deposit, maintenance, mobile, showNumber, status };
      await addDoc(collection(db, "flats"), flatObj);
      await loadFlats();

      if (type === "user") alert("Your flat is submitted and awaiting admin approval.");
      if (type === "admin") alert("Your flat is submitted and Posted.");
      if (type === "admin") clearForm("adminForm"); else clearForm("userForm");
    }

    async function approveFlat(id) {
      await updateDoc(doc(db, "flats", id), { status: "approved" });
      await loadFlats();
    }

    async function rejectFlat(id) {
      if (!confirm("Reject and delete this pending flat?")) return;
      await deleteDoc(doc(db, "flats", id));
      await loadFlats();
    }

    async function deleteFlat(id) {
      if (!confirm("Are you sure you want to delete this flat?")) return;
      await deleteDoc(doc(db, "flats", id));
      await loadFlats();
    }

    function renderFlats() {
      const list = document.getElementById("flatList");
      const header = document.getElementById("availableFlatsHeader");
      list.innerHTML = "";

      if (!flats || flats.length === 0) {
        header.style.display = "none";
        return;
      } else {
        header.style.display = "block";
      }

      flats.forEach(flat => {
        const card = document.createElement("div");
        card.className = "flat-card";
let contactHtml = "";

// Owner message
const defaultMsg = encodeURIComponent("Dear Owner, I am interested in your flat. Please share more details.");

// Team message including flat number
const teamMsg = `Dear Team, I am interested in renting flat ${flatNumber} in Elegance Enclave. Please share more details.`;
const defaultMsgforTeam = encodeURIComponent(teamMsg);

if (flat.showNumber === "Yes") {
  // owner contact
  contactHtml = `<p><strong>Owner Contact:</strong> ${flat.mobile}</p>
                 <a class="whatsapp" href="https://wa.me/91${flat.mobile}?text=${defaultMsg}" target="_blank" rel="noopener noreferrer">
                   Chat on WhatsApp
                 </a>`;
} else {
  // application team contact
  contactHtml = `<p><strong>Contact:</strong> <em>Via Application Team</em></p>
                 <a class="whatsapp" href="https://wa.me/91${defaultAppContact}?text=${defaultMsgforTeam}" target="_blank" rel="noopener noreferrer">
                   Contact App Team
                 </a>`;
}

        card.innerHTML = `
          <h3>Flat ${flat.flatNumber} ${flat.sqft ? `(${flat.sqft} sqft)` : ""}</h3>
          <p><strong>Floor:</strong> ${flat.floor || "N/A"}</p>
          <p><strong>Rent:</strong> ₹${flat.rent}</p>
          <p><strong>Deposit:</strong> ₹${flat.deposit}</p>
          <p><strong>Maintenance:</strong> ₹${flat.maintenance}</p>
          ${contactHtml}
        `;

        if (isAdmin) {
          const delBtn = document.createElement("button");
          delBtn.className = "delete-btn";
          delBtn.textContent = "Delete";
          delBtn.onclick = () => deleteFlat(flat.id);
          card.appendChild(delBtn);
        }
        list.appendChild(card);
      });
    }

    function renderPending() {
      const list = document.getElementById("pendingFlats");
      list.innerHTML = "";

      if (!pendingFlats || pendingFlats.length === 0) {
        list.innerHTML = "<p>No pending flats.</p>";
        return;
      }

      pendingFlats.forEach(flat => {
        const card = document.createElement("div");
        card.className = "flat-card";

        card.innerHTML = `
          <h3>Flat ${flat.flatNumber} (Pending)</h3>
          <p><strong>Floor:</strong> ${flat.floor || "N/A"}</p>
          <p><strong>Sqft:</strong> ${flat.sqft || "N/A"}</p>
          <p><strong>Rent:</strong> ₹${flat.rent}</p>
          <p><strong>Deposit:</strong> ₹${flat.deposit}</p>
          <p><strong>Maintenance:</strong> ₹${flat.maintenance}</p>
          <p><strong>Owner Mobile:</strong> ${flat.mobile}</p>
        `;

        const approveBtn = document.createElement("button");
        approveBtn.className = "approve-btn";
        approveBtn.textContent = "Approve";
        approveBtn.onclick = () => approveFlat(flat.id);

        const rejectBtn = document.createElement("button");
        rejectBtn.className = "reject-btn";
        rejectBtn.textContent = "Reject";
        rejectBtn.onclick = () => rejectFlat(flat.id);

        card.appendChild(approveBtn);
        card.appendChild(rejectBtn);
        list.appendChild(card);
      });
    }

    // Expose for inline handlers
    window.autoFillFloor = autoFillFloor;
    window.addFlat = addFlat;
    window.approveFlat = approveFlat;
    window.rejectFlat = rejectFlat;
    window.deleteFlat = deleteFlat;
    window.toggleLogin = toggleLogin;
    window.toggleUserForm = toggleUserForm;
    window.login = login;
    window.logout = logout;

    // Load on start
    loadFlats();
  </script>
</body>
</html>
